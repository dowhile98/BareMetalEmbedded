/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2025 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */
/*Inacludes -----------------------------------------------------------------*/

#include "stm32f4xx.h"

uint8_t SysTick_Init(uint32_t ticks);

void delay_ms(uint32_t delay);

int main(void)
{

	uint32_t ticks;
	RCC->AHB1ENR |= RCC_AHB1ENR_GPIODEN;
	//PD12
	GPIOD->MODER &=~ GPIO_MODER_MODE12;
	GPIOD->MODER |= GPIO_MODER_MODE12_0;

	ticks = SystemCoreClock /1000;

	SysTick_Init(ticks);


    /* Loop forever */
	for(;;);
}


uint8_t SysTick_Init(uint32_t ticks){
	//deshabilitar el contador
	SysTick->CTRL = 0;
	//establecer el valor de load
	SysTick->LOAD = ticks - 1;
	//limpiar el valor de val
	SysTick->VAL = 0;
	//habilitar el conteo
	SysTick->CTRL |= SysTick_CTRL_COUNTFLAG_Msk | SysTick_CTRL_CLKSOURCE_Msk;

	return 0;

}

void delay_ms(uint32_t delay){
	SysTick->VAL = 0;
	for(uint32_t i = 0; i < delay; i++){
		while(SysTick->CTRL & SysTick_CTRL_COUNTFLAG_Msk);
	}
}
